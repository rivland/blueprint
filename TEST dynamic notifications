blueprint:
  name: Notification de présence
  description: Envoie une notification basée sur la présence ou la proximité.
  domain: automation
  input:
    mode_de_clenchement:
      name: Mode de déclenchement
      description: Choisissez le mode de déclenchement (présence ou proximité)
      selector:
        select:
          options:
            - Présence
            - Proximité
      default: Présence
    capteur_presence:
      name: Capteur de présence
      description: Le capteur à utiliser pour détecter la présence
      selector:
        entity:
          domain: binary_sensor
          device_class: occupancy
      default: binary_sensor.maison_occupee
    personne_cible:
      name: Personne suivie
      description: La personne à suivre pour la proximité
      selector:
        entity:
          domain: person
    distance_max:
      name: Distance maximale
      description: Distance maximale pour la détection de la personne
      selector:
        number:
          min: 0
          max: 100
          unit_of_measurement: 'm'
          mode: box
      default: 10
    action_bouton_1:
      name: Action bouton 1
      description: Action à exécuter lors de l'appui sur le premier bouton
      selector:
        action: {}
    nom_bouton_1:
      name: Nom du bouton 1
      description: Nom du bouton qui déclenche l'action 1
      selector:
        text: {}
    action_bouton_2:
      name: Action bouton 2
      description: Action à exécuter lors de l'appui sur le deuxième bouton
      selector:
        action: {}
    nom_bouton_2:
      name: Nom du bouton 2
      description: Nom du bouton qui déclenche l'action 2
      selector:
        text: {}
    condition_suppression:
      name: Condition pour supprimer la notification
      description: Condition pour la suppression de la notification si nécessaire
      selector:
        text: {}
    valeur_suppression:
      name: Valeur de suppression
      description: Valeur à atteindre pour supprimer la notification
      selector:
        number:
          min: 0
          max: 100
          mode: box
      default: 5
    ajouter_boutons:
      name: Ajouter des boutons
      description: Ajouter des boutons à la notification
      selector:
        boolean: {}
      default: false

trigger:
  - platform: state
    entity_id: !input capteur_presence
    to: "on"

condition:
  - condition: template
    value_template: "{{ mode_de_clenchement == 'Proximité' and personne_cible is not none or mode_de_clenchement == 'Présence' }}"

action:
  - service: notify.mobile_app
    data:
      message: "Présence détectée"
      title: "Alerta de présence"
      data:
        actions:
          - action: "action_bouton_1"
            title: "{{ nom_bouton_1 }}"
          - action: "action_bouton_2"
            title: "{{ nom_bouton_2 }}"
        push:
          sound: "default"
