blueprint:
  name: Notification Dynamique - Base
  description: "Envoie une notification personnalisée selon un déclencheur défini."
  domain: automation
  input:
    trigger_event:
      name: Déclencheur
      description: "Sélectionne un déclencheur pour envoyer la notification."
      selector:
        trigger: {}

    enable_title:
      name: Activer le titre
      description: "Cochez cette case pour afficher un titre dans la notification."
      default: false
      selector:
        boolean: {}

    notif_title:
      name: Titre
      description: "Titre de la notification (utilisé seulement si activé)."
      default: ""
      selector:
        text: {}

    notif_message:
      name: Message
      description: "Contenu de la notification."
      selector:
        text: {}

    notify_device:
      name: Appareil(s) à notifier
      description: "Sélectionne les appareils à notifier lorsque l'automatisation se déclenche."
      default: []
      selector:
        device:
          filter:
            - integration: mobile_app
          multiple: true

mode: restart

trigger: !input trigger_event

action:
  - repeat:
      for_each: !input notify_device
      sequence:
        - service: "notify.mobile_app_{{ device_attr(repeat.item, 'name') | lower | replace(' ', '_') }}"
          data:
            title: >-
              {% if enable_title and notif_title | length > 0 %}
                {{ notif_title }}
              {% else %}
                {{ omit }}
              {% endif %}
            message: "{{ notif_message }}"
