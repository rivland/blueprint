blueprint:
  name: Surveillance avanc√©e NAS Synology + UPS (APC)
  description: |
    Un seul blueprint pour surveiller plusieurs param√®tres critiques :
    - CPU, RAM, temp√©rature, disque, volume, √©tat UPS.
    Envoie une notification si un seuil est d√©pass√© ou un √©tat critique d√©tect√©.
  domain: automation
  input:
    cpu_sensor:
      name: Capteur CPU
      default: ""
      selector:
        entity:
          domain: sensor
    seuil_cpu:
      name: Seuil CPU (%)
      default: 85
      selector:
        number:
          min: 10
          max: 100
          step: 1
          unit_of_measurement: '%'

    ram_sensor:
      name: Capteur RAM
      default: ""
      selector:
        entity:
          domain: sensor
    seuil_ram:
      name: Seuil RAM (%)
      default: 85
      selector:
        number:
          min: 10
          max: 100
          step: 1
          unit_of_measurement: '%'

    temp_sensor:
      name: Capteur temp√©rature NAS
      default: ""
      selector:
        entity:
          domain: sensor
    seuil_temp:
      name: Temp√©rature max (¬∞C)
      default: 60
      selector:
        number:
          min: 30
          max: 90
          unit_of_measurement: '¬∞C'
          step: 1

    volume_sensor:
      name: Capteur d‚Äôutilisation du volume (%)
      default: ""
      selector:
        entity:
          domain: sensor
    seuil_volume:
      name: Seuil d‚Äôutilisation disque (%)
      default: 90
      selector:
        number:
          min: 50
          max: 100
          unit_of_measurement: '%'
          step: 1

    status_volume:
      name: √âtat du volume (normal / degraded / crashed)
      default: ""
      selector:
        entity:
          domain: sensor

    ups_status:
      name: Capteur d‚Äô√©tat de l‚ÄôUPS (NUT)
      default: ""
      selector:
        entity:
          domain: sensor

    notification_device:
      name: Appareil de notification
      selector:
        device:
          integration: mobile_app

mode: queued
max: 10

trigger:
  - platform: numeric_state
    entity_id: !input cpu_sensor
    above: !input seuil_cpu
    id: cpu
  - platform: numeric_state
    entity_id: !input ram_sensor
    above: !input seuil_ram
    id: ram
  - platform: numeric_state
    entity_id: !input temp_sensor
    above: !input seuil_temp
    id: temp
  - platform: numeric_state
    entity_id: !input volume_sensor
    above: !input seuil_volume
    id: volume
  - platform: state
    entity_id: !input status_volume
    not_to: "normal"
    id: degraded
  - platform: state
    entity_id: !input ups_status
    to: "on battery"
    id: ups

action:
  - choose:
      - conditions:
          - condition: trigger
            id: cpu
        sequence:
          - device_id: !input notification_device
            domain: mobile_app
            type: notify
            message: "üî• Alerte CPU : d√©passe {{ seuil_cpu }} % sur ton NAS."
      - conditions:
          - condition: trigger
            id: ram
        sequence:
          - device_id: !input notification_device
            domain: mobile_app
            type: notify
            message: "üß† Alerte RAM : d√©passe {{ seuil_ram }} % sur ton NAS."
      - conditions:
          - condition: trigger
            id: temp
        sequence:
          - device_id: !input notification_device
            domain: mobile_app
            type: notify
            message: "üå°Ô∏è Alerte temp√©rature : d√©passe {{ seuil_temp }} ¬∞C sur ton NAS."
      - conditions:
          - condition: trigger
            id: volume
        sequence:
          - device_id: !input notification_device
            domain: mobile_app
            type: notify
            message: "üíæ Alerte disque : d√©passe {{ seuil_volume }} % d‚Äôoccupation sur le NAS."
      - conditions:
          - condition: trigger
            id: degraded
        sequence:
          - device_id: !input notification_device
            domain: mobile_app
            type: notify
            message: "‚ö†Ô∏è Le volume du NAS n‚Äôest pas en √©tat normal !"
      - conditions:
          - condition: trigger
            id: ups
        sequence:
          - device_id: !input notification_device
            domain: mobile_app
            type: notify
            message: "üîã Coupure secteur : le NAS fonctionne sur batterie (UPS)."

